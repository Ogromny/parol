#!/usr/bin/env ruby
require 'parol'
require 'thor'
require 'orpg'

class Command < Thor
  # puts 'Database password:'
  # password = STDIN.gets.chomp
  @data = Parol::Database.new "#{ENV['HOME']}/.config/parol/data", 'rL8CQ3C9pMBfDn9epQyjX6nNycKP3ZGh'

  desc 'create', 'Create a new account.'
  def create
    program  = ask('1. Input the name of the program:')
    login    = ask('2. Input the login:')
    password = yes?('3. Would you like parol to generate a strong password for you ? [y/n]')
    password = if password
                 ORPG::ORPG.generate 16, lowercase: true, uppercase: true, number: true, special: true
               else
                 ask('3.1 INput the password:')
               end
    notes = yes?('4. Some notes about this account ? [y/n]')
    notes = if notes
                 ask('4.1. Some notes:')
               else
                 ''
               end
    say "program : #{program}"
    say "login   : #{login}"
    say "password: #{password}"
    say "notes   : #{notes}"

    @data.add program, login, password, notes
  end

  desc 'list <index>', 'List everything.'
  def list index = nil
    @data.each do |data|
      say "[#{data[:program]} â†’ #{data[:login]} :: #{data[:password]} (#{data[:notes]})]"
    end
  end
end

#
#         desc 'delete <index>', 'Delete a particular index.'
#         def delete(index)
#             Database.remove(index)
#         end
#
#     end
# end
#
# Parol::Command.start(ARGV)

Command.start ARGV